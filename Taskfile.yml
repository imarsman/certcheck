version: "3"

vars:
  hostList: >
    ibm.com bbc.com amazon.com microsoft.com cisco.com workday.com o.canada.com
    www.thespec.com www.thestar.com www.parliament.gov.za www.gov.za
  targetbin: ~/bin
  buildname: certcheck

tasks:
  copy:
    desc: copy build file to local bin
    dir: .
    cmds:
      - cmd: rm {{.targetbin}}/{{.buildname}} && cp ./build/{{.buildname}} {{.targetbin}}
        ignore_error: true
  build:
    desc: build app
    dir: cmd/{{.buildname}}
    cmds:
      - rm -f ../../build/{{.buildname}}
      - go build -o ../../build/{{.buildname}} .
      - task: copy
  test:
    desc: test app
    dir: build
    cmds:
      - task: build
      - task: run
      - go test -v ../...
  run:
    desc: run from cli
    dir: build
    cmds:
      - time echo "{{.hostList}}" | ./{{.buildname}} -y
